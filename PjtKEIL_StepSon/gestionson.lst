


ARM Macro Assembler    Page 1 


    1 00000000                 PRESERVE8
    2 00000000                 THUMB
    3 00000000         
    4 00000000         
    5 00000000         ; ====================== zone de réservation de données,
                         ======================================
    6 00000000         ;Section RAM (read only) :
    7 00000000                 area             mesdata,data,readonly
    8 00000000         
    9 00000000         
   10 00000000         ;Section RAM (read write):
   11 00000000                 area             maram,data,readwrite
   12 00000000 00000000 
                       SortieSon
                               dcd              0
   13 00000004 00000000 
                       AdresseSon
                               dcd              0
   14 00000008         
   15 00000008         ; ======================================================
                       =========================================
   16 00000008         
   17 00000008                 extern           Son
   18 00000008                 export           CallbackSon
   19 00000008                 export           SortieSon
   20 00000008                 export           AdresseSon
   21 00000008                 extern           PWM_Set_Value_TIM3_Ch3
   22 00000008                 extern           LongueurSon
   23 00000008                 export           StartSon
   24 00000008         
   25 00000008         ;Section ROM code (read only) :  
   26 00000008                 area             moncode,code,readonly
   27 00000000         ; écrire le code ici 
   28 00000000         
   29 00000000         StartSon
                               proc
   30 00000000 481A            ldr              r0,=AdresseSon
   31 00000002 F04F 0100       mov              r1, #0
   32 00000006 6001            str              r1, [r0]
   33 00000008 4770            bx               lr
   34 0000000A                 endp
   35 0000000A         
   36 0000000A         CallbackSon
                               proc
   37 0000000A 4818            ldr              r0,=AdresseSon ;On stocke l'adr
                                                            esse de AdresseSon 
                                                            dans r0
   38 0000000C 4B18            ldr              r3,=SortieSon ;On stocke l'adre
                                                            sse de Sortie dans 
                                                            r3
   39 0000000E         
   40 0000000E 4A19            ldr              r2,=Son     ; On stocke l'adres
                                                            se  du son dans r2
   41 00000010         
   42 00000010 6801            ldr              r1,[r0]     ; On récupère la va
                                                            leur de AdresseSon 
                                                            dans r1
   43 00000012         
   44 00000012         ;SI AdresseSon vaut 0, c'est qu'on l'a pas initialisé ->



ARM Macro Assembler    Page 2 


                        On appele getStartPoint (pour set l'adresse dans notre 
                       programme)
   45 00000012 2900            cmp              r1, #0
   46 00000014 D025            beq              getStartPoint
   47 00000016         
   48 00000016         ; SI AdresseSon est égale à l'adresse de fin du son (adr
                       esse début du son + 2 * longueur son) -> On fait rien
   49 00000016 F84D CD04       push{r12}
   50 0000001A F8DF C05C       ldr              r12,=LongueurSon
   51 0000001E F8DC C000       ldr              r12, [r12]
   52 00000022 B401            push{r0}
   53 00000024 F04F 0002       mov              r0, #2
   54 00000028 FB0C FC00       mul              r12, r0
   55 0000002C BC01            pop{r0}
   56 0000002E 4494            add              r12, r2
   57 00000030 458C            cmp              r12, r1
   58 00000032 F85D CB04       pop{r12}
   59 00000036         
   60 00000036 D017            beq              exit
   61 00000038         
   62 00000038         
   63 00000038         
   64 00000038         
   65 00000038         ;Si Adresse son != 0 on continue et sinon on branche sur
                        indexzero
   66 00000038         ;dans ce cas là on est au premier appel de CallBackson
   67 00000038         ;Dans le cas ou c'est différent de 0 on continue
   68 00000038         
   69 00000038         ;on incrémente la valeur de adresseson de 16bits (2octet
                       s)
   70 00000038 F101 0102       add              r1,#2
   71 0000003C         
   72 0000003C         SuiteCallback
   73 0000003C 6001            str              r1,[r0]     ;on la stocke dans 
                                                            adresseson
   74 0000003E F9B1 1000       ldrsh            r1,[r1]     ;on récupère la val
                                                            eur à la nouvelle a
                                                            dresse (ldr signé h
                                                            alf - on prend que 
                                                            2 octets-)
   75 00000042         ;On divise par 2^16/720=4096/45 -> on mul par 45 et div 
                       par 4096 :: NORMALISATION
   76 00000042 F04F 022D       mov              r2, #45
   77 00000046 FB01 F102       mul              r1,r2
   78 0000004A F44F 5280       mov              r2, #4096
   79 0000004E FB91 F1F2       sdiv             r1, r2
   80 00000052 F511 71B4       adds             r1, #360
   81 00000056 6019            str              r1,[r3]     ;on la mets dans so
                                                            rtie son
   82 00000058         
   83 00000058         ;et on set la PWM
   84 00000058 B500            push             {lr}
   85 0000005A 4608            mov              r0,r1
   86 0000005C F7FF FFFE       bl               PWM_Set_Value_TIM3_Ch3
   87 00000060 BD00            pop              {pc}
   88 00000062         
   89 00000062         getStartPoint                        ; on mets l'adresse
                                                             du son dans r1 et 
                                                            dans la variable Ad



ARM Macro Assembler    Page 3 


                                                            resseSon
   90 00000062 4611            mov              r1,r2
   91 00000064 6002            str              r2,[r0]
   92 00000066 E7E9            b                SuiteCallback
   93 00000068         exit
   94 00000068 4770            bx               lr
   95 0000006A                 endp
   96 0000006A         
   97 0000006A         
   98 0000006A         
   99 0000006A         
  100 0000006A                 END
              00 00 00000000 
              00000000 
              00000000 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --apcs=interw
ork --depend=.\obj\gestionson.d -o.\obj\gestionson.o -I.\RTE\_CibleSondeKEIL -I
D:\Programmes\ARM\CMSIS\5.7.0\CMSIS\Core\Include -ID:\Programmes\Keil\STM32F1xx
_DFP\2.3.0\Device\Include --predefine="__EVAL SETA 1" --predefine="__MICROLIB S
ETA 1" --predefine="__UVISION_VERSION SETA 533" --predefine="_RTE_ SETA 1" --pr
edefine="STM32F10X_MD SETA 1" --predefine="_RTE_ SETA 1" --list=gestionson.lst 
Src\GestionSon.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

mesdata 00000000

Symbol: mesdata
   Definitions
      At line 7 in file Src\GestionSon.s
   Uses
      None
Comment: mesdata unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

AdresseSon 00000004

Symbol: AdresseSon
   Definitions
      At line 13 in file Src\GestionSon.s
   Uses
      At line 20 in file Src\GestionSon.s
      At line 30 in file Src\GestionSon.s
      At line 37 in file Src\GestionSon.s

SortieSon 00000000

Symbol: SortieSon
   Definitions
      At line 12 in file Src\GestionSon.s
   Uses
      At line 19 in file Src\GestionSon.s
      At line 38 in file Src\GestionSon.s

maram 00000000

Symbol: maram
   Definitions
      At line 11 in file Src\GestionSon.s
   Uses
      None
Comment: maram unused
3 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

CallbackSon 0000000A

Symbol: CallbackSon
   Definitions
      At line 36 in file Src\GestionSon.s
   Uses
      At line 18 in file Src\GestionSon.s
Comment: CallbackSon used once
StartSon 00000000

Symbol: StartSon
   Definitions
      At line 29 in file Src\GestionSon.s
   Uses
      At line 23 in file Src\GestionSon.s
Comment: StartSon used once
SuiteCallback 0000003C

Symbol: SuiteCallback
   Definitions
      At line 72 in file Src\GestionSon.s
   Uses
      At line 92 in file Src\GestionSon.s
Comment: SuiteCallback used once
exit 00000068

Symbol: exit
   Definitions
      At line 93 in file Src\GestionSon.s
   Uses
      At line 60 in file Src\GestionSon.s
Comment: exit used once
getStartPoint 00000062

Symbol: getStartPoint
   Definitions
      At line 89 in file Src\GestionSon.s
   Uses
      At line 46 in file Src\GestionSon.s
Comment: getStartPoint used once
moncode 00000000

Symbol: moncode
   Definitions
      At line 26 in file Src\GestionSon.s
   Uses
      None
Comment: moncode unused
6 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

LongueurSon 00000000

Symbol: LongueurSon
   Definitions
      At line 22 in file Src\GestionSon.s
   Uses
      At line 50 in file Src\GestionSon.s
Comment: LongueurSon used once
PWM_Set_Value_TIM3_Ch3 00000000

Symbol: PWM_Set_Value_TIM3_Ch3
   Definitions
      At line 21 in file Src\GestionSon.s
   Uses
      At line 86 in file Src\GestionSon.s
Comment: PWM_Set_Value_TIM3_Ch3 used once
Son 00000000

Symbol: Son
   Definitions
      At line 17 in file Src\GestionSon.s
   Uses
      At line 40 in file Src\GestionSon.s
Comment: Son used once
3 symbols
350 symbols in table
